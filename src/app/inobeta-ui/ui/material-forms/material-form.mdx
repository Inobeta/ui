import { Meta, Canvas, Source } from "@storybook/blocks";

import * as MatFormStories from "./material-form.stories";

<Meta title="Forms/Overview" />

# Forms

## Getting started

First, add `ib-material-form` to your page's template.

Then, add field definitions through the `fields` input.

> **Don't forget to add at least a form action with key `"submit"`**

Lastly, listen to `(ibSubmit)` to, for example, send a request to an endpoint.

```typescript
@Component({
  selector: "app-form-example",
  template: `form.component.html`,
})
export class FormExampleComponent {
  fields = [
    // your fields
  ];

  // An action with a submit key is *always* required
  actions = [
    new IbMatButtonControl({
      key: "submit",
      label: "Login",
    }),
  ];

  handleSubmit(data) {
    // ...
  }
}
```

```html
<!-- form.component.html -->
<ib-material-form
  [fields]="fields"
  [actions]="actions"
  (ibSubmit)="handleSubmit($event)"
/>
```

## Form fields

Form fields are defined through an array of control instances.  
The only required values are `key` and `label`, where `key` is assigned as `formControlName`  
You can find a list of available controls [here](/docs/forms-controls--docs)

```typescript
fields = [
  new IbMatTextboxControl({
    key: "fullName",
    label: "Full name",
  }),
];
```

<Canvas of={MatFormStories.Textbox} />

## Form actions

It is possible to extend the available actions beyond submit through the `actions` input.  
Each action needs a `key`, `label`, and `handler` (callback) field (except for the button related to form submit.)

```typescript
customActions = [
  // ðŸ‘‡ this is required! 
  new IbMatButtonControl({
    key: "submit",
    label: "Search",
  }),
  new IbMatButtonControl({
    key: "clear",
    label: "Clear",
    color: "accent",
    requireConfirmOnDirty: true,
    handler: (form) => form.reset(),
  }),
  new IbMatButtonControl({
    key: "disable",
    label: "Disable",
    handler: (form) => form.disable(),
  }),
  new IbMatButtonControl({
    key: "enable",
    label: "Enable",
    handler: (form) => form.enable(),
  }),
];
```

## Validation

Every form control has a `validators` key.
It accepts an array of `ValidatorFn`, like either one provided from `Validators` or your own.

```typescript
fields = [
  new IbMatTextboxControl({
    key: "email",
    label: "Email",
    type: "email",
    validators: [Validators.email, Validators.required],
    width: "100%",
  }),
  new IbMatTextboxControl({
    key: "password",
    label: "Password",
    type: "password",
    validators: [Validators.required],
    width: "100%",
  }),
  new IbMatCheckboxControl({
    key: "storeUserAgent",
    label: "Ricorda su questo dispositivo",
    width: "100%",
  }),
];
```

<Canvas of={MatFormStories.SimpleLogin} />

## Form array

With `IbFormArray` define a form array where a user can add a variable amount of lines of pre-defined fields.  
Same as a form control, it requires a `key` parameter, which corresponds to the key in the FormGroup; 
and the `fields` parameter accepts any control available.

To limit the maximum amount of lines, set the `options.max` parameter to a value greater than zero.

```typescript
fields = [
  // ...
  new IbFormArray({
    key: "addresses",
    options: {
      max: 2,
    },
    fields: [
      new IbMatTextboxControl({
        key: "key",
        label: "(es. Phone, Email)",
        width: "25%",
      }),
      new IbMatTextboxControl({
        key: "value",
        label: "es. +39123123",
        validators: [Validators.required],
        width: "25%",
      }),
    ],
  }),
];
```

<Canvas of={MatFormStories.WithFormArray} />
